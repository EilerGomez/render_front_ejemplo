{"ast":null,"code":"import { Compra } from 'src/app/Modelo/Compra';\nimport { ProdcutosCompra } from 'src/app/Modelo/ProductosCompra';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/Service/compras.service\";\nimport * as i2 from \"src/app/Service/productos.service\";\nimport * as i3 from \"src/app/Service/serviciotable.service\";\nimport * as i4 from \"@angular/forms\";\nexport class ComprasComponent {\n  constructor(servicioCompras, servicioProductos, serviceTable) {\n    this.servicioCompras = servicioCompras;\n    this.servicioProductos = servicioProductos;\n    this.serviceTable = serviceTable;\n    this.mostrarNuevaCompra = false;\n    this.totalNuevaCompra = 0;\n    this.mostrarDetalles = false;\n  }\n  ngOnInit() {\n    this.serviceTable.getTable().subscribe(data => {\n      this.obj = data;\n      //this.traerProductos();\n    }, error => {\n      console.log(error);\n    });\n  }\n  verDetalles(compra) {\n    this.mostrarDetalles = true;\n    this.servicioProductos.getProductosNuevaCompra(compra.codigo, this.getRolDB()).subscribe(data => {\n      this.productosNuevaCompra = data;\n      this.codigoDetalleCompra = compra.codigo;\n      this.totalNuevaCompra = compra.total_compra;\n    });\n  }\n  filtrarCompras(filtro) {\n    console.log(\"filtro: \" + filtro);\n  }\n  getRolDB() {\n    let stringUser = localStorage.getItem('usuario');\n    let usuario = stringUser ? JSON.parse(stringUser) : null;\n    let rol = usuario ? usuario.rol : 0;\n    return rol;\n  }\n  getIDUser() {\n    let stringUser = localStorage.getItem('usuario');\n    let usuario = stringUser ? JSON.parse(stringUser) : null;\n    let rol = usuario ? usuario.identificacion : 0;\n    return rol;\n  }\n  getSucursal() {\n    let stringUser = localStorage.getItem('usuario');\n    let usuario = stringUser ? JSON.parse(stringUser) : null;\n    let suc = usuario ? usuario.sucursal : 0;\n    return suc;\n  }\n  nuevaCompra() {\n    //hacer que se agregue una nueva compra\n    this.productosNuevaCompra = [];\n    this.totalNuevaCompra = 0;\n    this.mostrarNuevaCompra = true;\n    let compra = new Compra();\n    compra.usuario = this.getIDUser();\n    compra.sucursal = this.getSucursal();\n    this.servicioCompras.nuevaCompra(compra, this.getRolDB()).subscribe(data => {\n      this.codigoNuevaCompra = data.codigo_compra;\n      console.log(this.codigoNuevaCompra);\n    }, error => {\n      console.log(error);\n    });\n  }\n  traerProductosNuevaCompra(idC) {\n    this.servicioProductos.getProductosNuevaCompra(idC, this.getRolDB()).subscribe(data => {\n      this.productosNuevaCompra = data;\n    }, error => {\n      console.log(error);\n    });\n  }\n  agregarProductoACompra(nuevaCompraForm) {\n    let pc = new ProdcutosCompra(this.codigoNuevaCompra, parseInt(this.productoSeleccionado), this.cantidadProducto, this.precioProducto);\n    this.servicioProductos.nuevoProductoCompra(pc, this.getRolDB()).subscribe(data => {\n      console.log(data);\n      this.traerProductosNuevaCompra(this.codigoNuevaCompra);\n      nuevaCompraForm.resetForm();\n      this.totalNuevaCompra += pc.cantidad * pc.precio_unitario;\n      this.traerProductos();\n    }, error => {\n      console.log(error);\n      alert(\"No cuentas con el dinero sufuciente para realizar esta compra, por favor comunicate con el administrador\");\n    });\n  }\n  traerProductos() {\n    this.servicioProductos.getProductosSucursal(this.getSucursal(), this.getRolDB()).subscribe(data => {\n      this.productos = data;\n    }, error => {\n      console.log(error);\n    });\n  }\n  dejarDeMostrarNuevaCompra() {\n    this.mostrarNuevaCompra = false;\n    if (this.totalNuevaCompra == 0) {\n      //eliminar la compra\n      this.servicioCompras.deleteCompra(this.getRolDB(), this.codigoNuevaCompra).subscribe(data => {\n        console.log(\"compra eliminada\");\n        this.ngOnInit();\n      });\n    } else {\n      this.ngOnInit();\n    }\n  }\n  cancelarCompra() {\n    this.servicioCompras.cancelarCompra(this.getRolDB(), this.codigoNuevaCompra).subscribe(data => {\n      alert(\"Se la cancelado al compra!\");\n      this.mostrarNuevaCompra = false;\n      this.ngOnInit();\n    }, error => {\n      console.log(error);\n    });\n  }\n  static #_ = this.ɵfac = function ComprasComponent_Factory(t) {\n    return new (t || ComprasComponent)(i0.ɵɵdirectiveInject(i1.ComprasService), i0.ɵɵdirectiveInject(i2.ProductosService), i0.ɵɵdirectiveInject(i3.ServiciotableService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ComprasComponent,\n    selectors: [[\"app-compras\"]],\n    decls: 44,\n    vars: 5,\n    consts: [[1, \"container\", \"mt-5\", \"pt-5\"], [1, \"card\", \"mb-4\"], [1, \"card-header\", \"bg-primary\", \"text-white\"], [1, \"card-body\"], [3, \"ngSubmit\"], [\"personaForm\", \"ngForm\"], [1, \"row\"], [1, \"col-md-4\"], [1, \"form-group\"], [\"for\", \"nombre\"], [\"type\", \"text\", \"id\", \"nombre\", \"name\", \"nombre\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"col-md-3\"], [\"for\", \"edad\"], [\"type\", \"number\", \"id\", \"edad\", \"name\", \"edad\", \"required\", \"\", \"min\", \"1\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"parentesco\"], [\"id\", \"parentesco\", \"name\", \"parentesco\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"value\", \"\"], [\"value\", \"Padre\"], [\"value\", \"Madre\"], [\"value\", \"Hijo/a\"], [\"value\", \"Hermano/a\"], [\"value\", \"Otro\"], [1, \"col-md-2\", \"d-flex\", \"align-items-end\"], [\"type\", \"submit\", 1, \"btn\", \"btn-success\", \"btn-block\", 3, \"disabled\"], [1, \"fas\", \"fa-save\"], [1, \"card\"], [1, \"table\", \"table-bordered\"]],\n    template: function ComprasComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h4\");\n        i0.ɵɵtext(4, \"Agregar Nueva Persona\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(5, \"div\", 3)(6, \"form\", 4, 5);\n        i0.ɵɵlistener(\"ngSubmit\", function ComprasComponent_Template_form_ngSubmit_6_listener() {\n          return ctx.guardar();\n        });\n        i0.ɵɵelementStart(8, \"div\", 6)(9, \"div\", 7)(10, \"div\", 8)(11, \"label\", 9);\n        i0.ɵɵtext(12, \"Nombre\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(13, \"input\", 10);\n        i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_Template_input_ngModelChange_13_listener($event) {\n          return ctx.nuevaPersona.nombre = $event;\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(14, \"div\", 11)(15, \"div\", 8)(16, \"label\", 12);\n        i0.ɵɵtext(17, \"Edad\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"input\", 13);\n        i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_Template_input_ngModelChange_18_listener($event) {\n          return ctx.nuevaPersona.edad = $event;\n        });\n        i0.ɵɵelementEnd()()();\n        i0.ɵɵelementStart(19, \"div\", 11)(20, \"div\", 8)(21, \"label\", 14);\n        i0.ɵɵtext(22, \"Parentesco\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(23, \"select\", 15);\n        i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_Template_select_ngModelChange_23_listener($event) {\n          return ctx.nuevaPersona.parentesco = $event;\n        });\n        i0.ɵɵelementStart(24, \"option\", 16);\n        i0.ɵɵtext(25, \"Seleccione...\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(26, \"option\", 17);\n        i0.ɵɵtext(27, \"Padre\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(28, \"option\", 18);\n        i0.ɵɵtext(29, \"Madre\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(30, \"option\", 19);\n        i0.ɵɵtext(31, \"Hijo/a\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(32, \"option\", 20);\n        i0.ɵɵtext(33, \"Hermano/a\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(34, \"option\", 21);\n        i0.ɵɵtext(35, \"Otro\");\n        i0.ɵɵelementEnd()()()();\n        i0.ɵɵelementStart(36, \"div\", 22)(37, \"button\", 23);\n        i0.ɵɵelement(38, \"i\", 24);\n        i0.ɵɵtext(39, \" Guardar \");\n        i0.ɵɵelementEnd()()()()()();\n        i0.ɵɵelementStart(40, \"div\", 25)(41, \"h3\");\n        i0.ɵɵtext(42);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(43, \"table\", 26);\n        i0.ɵɵelementEnd()();\n      }\n      if (rf & 2) {\n        const _r0 = i0.ɵɵreference(7);\n        i0.ɵɵadvance(13);\n        i0.ɵɵproperty(\"ngModel\", ctx.nuevaPersona.nombre);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngModel\", ctx.nuevaPersona.edad);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngModel\", ctx.nuevaPersona.parentesco);\n        i0.ɵɵadvance(14);\n        i0.ɵɵproperty(\"disabled\", !_r0.valid);\n        i0.ɵɵadvance(5);\n        i0.ɵɵtextInterpolate1(\"Totales (\", ctx.obj.length, \") \");\n      }\n    },\n    dependencies: [i4.ɵNgNoValidate, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.NumberValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.NgControlStatusGroup, i4.RequiredValidator, i4.MinValidator, i4.NgModel, i4.NgForm],\n    styles: [\"\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsInNvdXJjZVJvb3QiOiIifQ== */\"]\n  });\n}","map":{"version":3,"mappings":"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","names":["Compra","ProdcutosCompra","ComprasComponent","constructor","servicioCompras","servicioProductos","serviceTable","ngOnInit","getTable","subscribe","data","obj","error","console","log","verDetalles","compra","mostrarDetalles","getProductosNuevaCompra","codigo","getRolDB","productosNuevaCompra","codigoDetalleCompra","totalNuevaCompra","total_compra","filtrarCompras","filtro","stringUser","localStorage","getItem","usuario","JSON","parse","rol","getIDUser","identificacion","getSucursal","suc","sucursal","nuevaCompra","mostrarNuevaCompra","codigoNuevaCompra","codigo_compra","traerProductosNuevaCompra","idC","agregarProductoACompra","nuevaCompraForm","pc","parseInt","productoSeleccionado","cantidadProducto","precioProducto","nuevoProductoCompra","resetForm","cantidad","precio_unitario","traerProductos","alert","getProductosSucursal","productos","dejarDeMostrarNuevaCompra","deleteCompra","cancelarCompra","selectors","decls","vars","consts","template","i0","ctx"],"sourceRoot":"","sources":["/home/eiler/Documentos/proyectosPruebas/FRONT_Render/src/app/area-bodega/compras/compras.component.ts","/home/eiler/Documentos/proyectosPruebas/FRONT_Render/src/app/area-bodega/compras/compras.component.html"],"sourcesContent":["import { Component, OnInit } from '@angular/core';\nimport { Compra } from 'src/app/Modelo/Compra';\nimport { ComprasService } from 'src/app/Service/compras.service';\nimport { Usuario } from 'src/app/Modelo/Usuario';\nimport { data, error } from 'jquery';\nimport { Producto } from 'src/app/Modelo/Producto';\nimport { ProductosService } from 'src/app/Service/productos.service';\nimport { ProdcutosCompra } from 'src/app/Modelo/ProductosCompra';\nimport { NgForm } from '@angular/forms';\nimport { MyTable } from 'src/app/Modelo/mytable';\nimport { ServiciotableService } from 'src/app/Service/serviciotable.service';\n@Component({\n  selector: 'app-compras',\n  templateUrl: './compras.component.html',\n  styleUrls: ['./compras.component.css']\n})\nexport class ComprasComponent {\n  constructor(private servicioCompras:ComprasService, private servicioProductos:ProductosService,\n    private serviceTable:ServiciotableService\n  ){}\n  compras!:Compra[]\n  obj!:MyTable[]\n  mostrarNuevaCompra:boolean=false;\n  productos!:Producto[]\n\n  precioProducto!:number\n  cantidadProducto!:number\n  productoSeleccionado!:any\n\n  codigoNuevaCompra!:number\n\n  productosNuevaCompra !:ProdcutosCompra[]\n\n  totalNuevaCompra:number=0;\n\n  codigoDetalleCompra!:number\n  mostrarDetalles:boolean=false;\n\n  ngOnInit():void{\n    this.serviceTable.getTable().subscribe(data=>{\n      this.obj=data;\n      //this.traerProductos();\n    }, error=>{\n      console.log(error)\n      \n    })\n  }\n  verDetalles(compra:Compra){\n    this.mostrarDetalles=true;\n    this.servicioProductos.getProductosNuevaCompra(compra.codigo,this.getRolDB()).subscribe(data=>{\n      this.productosNuevaCompra=data\n      this.codigoDetalleCompra=compra.codigo\n      this.totalNuevaCompra=compra.total_compra\n    })\n  }\n\n  filtrarCompras(filtro:string){\n    console.log(\"filtro: \" + filtro)\n  }\n\n  getRolDB(){\n    let stringUser = localStorage.getItem('usuario');\n    let usuario:Usuario = stringUser? JSON.parse(stringUser):null;\n    let rol = usuario? usuario.rol:0;\n    return rol;\n  }\n  getIDUser(){\n    let stringUser = localStorage.getItem('usuario');\n    let usuario:Usuario = stringUser? JSON.parse(stringUser):null;\n    let rol = usuario? usuario.identificacion:0;\n    return rol;\n  }\n  getSucursal(){\n    let stringUser = localStorage.getItem('usuario');\n    let usuario:Usuario = stringUser? JSON.parse(stringUser):null;\n    let suc = usuario? usuario.sucursal:0;\n    return suc;\n  }\n\n  nuevaCompra(){\n    //hacer que se agregue una nueva compra\n    this.productosNuevaCompra= []\n    this.totalNuevaCompra=0;\n    this.mostrarNuevaCompra=true;\n    let compra = new Compra();\n    compra.usuario=this.getIDUser();\n    compra.sucursal=this.getSucursal();\n    this.servicioCompras.nuevaCompra(compra,this.getRolDB()).subscribe(data=>{\n      this.codigoNuevaCompra=data.codigo_compra;\n      console.log(this.codigoNuevaCompra)\n      \n    },error=>{\n      console.log(error)\n    })\n  }\n\n  traerProductosNuevaCompra(idC:number){\n    this.servicioProductos.getProductosNuevaCompra(idC,this.getRolDB()).subscribe(data=>{\n      this.productosNuevaCompra=data;\n    },error=>{\n      console.log(error)\n    })\n  }\n\n  agregarProductoACompra(nuevaCompraForm:NgForm) {\n    let pc = new ProdcutosCompra(this.codigoNuevaCompra,parseInt(this.productoSeleccionado),this.cantidadProducto,this.precioProducto);\n    this.servicioProductos.nuevoProductoCompra(pc,this.getRolDB()).subscribe(data=>{\n      console.log(data);\n      this.traerProductosNuevaCompra(this.codigoNuevaCompra);\n      nuevaCompraForm.resetForm();\n      this.totalNuevaCompra+=pc.cantidad*pc.precio_unitario;\n      this.traerProductos();\n    }, error=>{\n      console.log(error)\n      alert(\"No cuentas con el dinero sufuciente para realizar esta compra, por favor comunicate con el administrador\")\n    })\n  }\n\n  traerProductos(){\n    this.servicioProductos.getProductosSucursal(this.getSucursal(),this.getRolDB()).subscribe(data=>{\n      this.productos=data;\n    }, error=>{\n      console.log(error)\n    })\n  }\n\n  dejarDeMostrarNuevaCompra(){\n    this.mostrarNuevaCompra=false;\n    if(this.totalNuevaCompra==0){\n      //eliminar la compra\n      this.servicioCompras.deleteCompra(this.getRolDB(),this.codigoNuevaCompra).subscribe(data=>{\n        console.log(\"compra eliminada\");\n        this.ngOnInit();\n      })\n    }else{\n      this.ngOnInit();\n    }\n  }\n\n  cancelarCompra(){\n    this.servicioCompras.cancelarCompra(this.getRolDB(),this.codigoNuevaCompra).subscribe(data=>{\n      alert(\"Se la cancelado al compra!\");\n      this.mostrarNuevaCompra=false;\n      this.ngOnInit();\n    }, error=>{\n      console.log(error);\n    })\n  }\n  \n\n\n\n}\n","<div class=\"container mt-5 pt-5\">\n    <!-- Formulario para agregar nueva persona -->\n    <div class=\"card mb-4\">\n        <div class=\"card-header bg-primary text-white\">\n            <h4>Agregar Nueva Persona</h4>\n        </div>\n        <div class=\"card-body\">\n            <form (ngSubmit)=\"guardar()\" #personaForm=\"ngForm\">\n                <div class=\"row\">\n                    <div class=\"col-md-4\">\n                        <div class=\"form-group\">\n                            <label for=\"nombre\">Nombre</label>\n                            <input type=\"text\" class=\"form-control\" id=\"nombre\" \n                                   [(ngModel)]=\"nuevaPersona.nombre\" \n                                   name=\"nombre\" required>\n                        </div>\n                    </div>\n                    <div class=\"col-md-3\">\n                        <div class=\"form-group\">\n                            <label for=\"edad\">Edad</label>\n                            <input type=\"number\" class=\"form-control\" id=\"edad\" \n                                   [(ngModel)]=\"nuevaPersona.edad\" \n                                   name=\"edad\" required min=\"1\">\n                        </div>\n                    </div>\n                    <div class=\"col-md-3\">\n                        <div class=\"form-group\">\n                            <label for=\"parentesco\">Parentesco</label>\n                            <select class=\"form-control\" id=\"parentesco\" \n                                    [(ngModel)]=\"nuevaPersona.parentesco\" \n                                    name=\"parentesco\" required>\n                                <option value=\"\">Seleccione...</option>\n                                <option value=\"Padre\">Padre</option>\n                                <option value=\"Madre\">Madre</option>\n                                <option value=\"Hijo/a\">Hijo/a</option>\n                                <option value=\"Hermano/a\">Hermano/a</option>\n                                <option value=\"Otro\">Otro</option>\n                            </select>\n                        </div>\n                    </div>\n                    <div class=\"col-md-2 d-flex align-items-end\">\n                        <button type=\"submit\" class=\"btn btn-success btn-block\" \n                                [disabled]=\"!personaForm.valid\">\n                            <i class=\"fas fa-save\"></i> Guardar\n                        </button>\n                    </div>\n                </div>\n            </form>\n        </div>\n    </div>\n\n    <!-- Tabla de personas existentes -->\n    <div class=\"card\">\n        <h3>Totales ({{obj.length}}) </h3>\n        <table class=\"table table-bordered\">\n            <!-- ... (tu tabla actual permanece igual) ... -->\n        </table>\n    </div>\n</div>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}