{"ast":null,"code":"import { Compra } from 'src/app/Modelo/Compra';\nimport { ProdcutosCompra } from 'src/app/Modelo/ProductosCompra';\nimport { MyTable } from 'src/app/Modelo/mytable';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/Service/compras.service\";\nimport * as i2 from \"src/app/Service/productos.service\";\nimport * as i3 from \"src/app/Service/serviciotable.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nfunction ComprasComponent_tr_57_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"td\", 27);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const b_r2 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(b_r2.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(b_r2.nombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(b_r2.edad);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(b_r2.parentesco);\n  }\n}\nexport let ComprasComponent = /*#__PURE__*/(() => {\n  class ComprasComponent {\n    constructor(servicioCompras, servicioProductos, serviceTable) {\n      this.servicioCompras = servicioCompras;\n      this.servicioProductos = servicioProductos;\n      this.serviceTable = serviceTable;\n      this.nuevaPersona = new MyTable(null, '', null, '');\n      this.mostrarNuevaCompra = false;\n      this.totalNuevaCompra = 0;\n      this.mostrarDetalles = false;\n    }\n    ngOnInit() {\n      this.serviceTable.getTable().subscribe(data => {\n        this.obj = data;\n        //this.traerProductos();\n      }, error => {\n        console.log(error);\n      });\n    }\n    guardar() {\n      // Aquí va tu lógica para guardar (ejemplo con HTTP POST)\n      this.serviceTable.postTable(this.nuevaPersona).subscribe({\n        next: data => {\n          this.nuevaPersona.id = Number(data.id);\n          alert('Persona guardada correctamente');\n          this.obj.unshift(this.nuevaPersona); // Agrega la nueva persona a la tabla\n          this.resetForm();\n        },\n        error: err => {\n          console.error('Error al guardar:', err);\n          alert('Error al guardar la persona');\n        }\n      });\n    }\n    resetForm() {\n      this.nuevaPersona = {\n        id: null,\n        nombre: '',\n        edad: null,\n        parentesco: ''\n      };\n    }\n    verDetalles(compra) {\n      this.mostrarDetalles = true;\n      this.servicioProductos.getProductosNuevaCompra(compra.codigo, this.getRolDB()).subscribe(data => {\n        this.productosNuevaCompra = data;\n        this.codigoDetalleCompra = compra.codigo;\n        this.totalNuevaCompra = compra.total_compra;\n      });\n    }\n    filtrarCompras(filtro) {\n      console.log(\"filtro: \" + filtro);\n    }\n    getRolDB() {\n      let stringUser = localStorage.getItem('usuario');\n      let usuario = stringUser ? JSON.parse(stringUser) : null;\n      let rol = usuario ? usuario.rol : 0;\n      return rol;\n    }\n    getIDUser() {\n      let stringUser = localStorage.getItem('usuario');\n      let usuario = stringUser ? JSON.parse(stringUser) : null;\n      let rol = usuario ? usuario.identificacion : 0;\n      return rol;\n    }\n    getSucursal() {\n      let stringUser = localStorage.getItem('usuario');\n      let usuario = stringUser ? JSON.parse(stringUser) : null;\n      let suc = usuario ? usuario.sucursal : 0;\n      return suc;\n    }\n    nuevaCompra() {\n      //hacer que se agregue una nueva compra\n      this.productosNuevaCompra = [];\n      this.totalNuevaCompra = 0;\n      this.mostrarNuevaCompra = true;\n      let compra = new Compra();\n      compra.usuario = this.getIDUser();\n      compra.sucursal = this.getSucursal();\n      this.servicioCompras.nuevaCompra(compra, this.getRolDB()).subscribe(data => {\n        this.codigoNuevaCompra = data.codigo_compra;\n        console.log(this.codigoNuevaCompra);\n      }, error => {\n        console.log(error);\n      });\n    }\n    traerProductosNuevaCompra(idC) {\n      this.servicioProductos.getProductosNuevaCompra(idC, this.getRolDB()).subscribe(data => {\n        this.productosNuevaCompra = data;\n      }, error => {\n        console.log(error);\n      });\n    }\n    agregarProductoACompra(nuevaCompraForm) {\n      let pc = new ProdcutosCompra(this.codigoNuevaCompra, parseInt(this.productoSeleccionado), this.cantidadProducto, this.precioProducto);\n      this.servicioProductos.nuevoProductoCompra(pc, this.getRolDB()).subscribe(data => {\n        console.log(data);\n        this.traerProductosNuevaCompra(this.codigoNuevaCompra);\n        nuevaCompraForm.resetForm();\n        this.totalNuevaCompra += pc.cantidad * pc.precio_unitario;\n        this.traerProductos();\n      }, error => {\n        console.log(error);\n        alert(\"No cuentas con el dinero sufuciente para realizar esta compra, por favor comunicate con el administrador\");\n      });\n    }\n    traerProductos() {\n      this.servicioProductos.getProductosSucursal(this.getSucursal(), this.getRolDB()).subscribe(data => {\n        this.productos = data;\n      }, error => {\n        console.log(error);\n      });\n    }\n    dejarDeMostrarNuevaCompra() {\n      this.mostrarNuevaCompra = false;\n      if (this.totalNuevaCompra == 0) {\n        //eliminar la compra\n        this.servicioCompras.deleteCompra(this.getRolDB(), this.codigoNuevaCompra).subscribe(data => {\n          console.log(\"compra eliminada\");\n          this.ngOnInit();\n        });\n      } else {\n        this.ngOnInit();\n      }\n    }\n    cancelarCompra() {\n      this.servicioCompras.cancelarCompra(this.getRolDB(), this.codigoNuevaCompra).subscribe(data => {\n        alert(\"Se la cancelado al compra!\");\n        this.mostrarNuevaCompra = false;\n        this.ngOnInit();\n      }, error => {\n        console.log(error);\n      });\n    }\n    static #_ = this.ɵfac = function ComprasComponent_Factory(t) {\n      return new (t || ComprasComponent)(i0.ɵɵdirectiveInject(i1.ComprasService), i0.ɵɵdirectiveInject(i2.ProductosService), i0.ɵɵdirectiveInject(i3.ServiciotableService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ComprasComponent,\n      selectors: [[\"app-compras\"]],\n      decls: 58,\n      vars: 6,\n      consts: [[1, \"container\", \"mt-5\", \"pt-5\"], [1, \"card\", \"mb-4\"], [1, \"card-header\", \"bg-primary\", \"text-white\"], [1, \"card-body\"], [3, \"ngSubmit\"], [\"personaForm\", \"ngForm\"], [1, \"row\"], [1, \"col-md-4\"], [1, \"form-group\"], [\"for\", \"nombre\"], [\"type\", \"text\", \"id\", \"nombre\", \"name\", \"nombre\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"col-md-3\"], [\"for\", \"edad\"], [\"type\", \"number\", \"id\", \"edad\", \"name\", \"edad\", \"required\", \"\", \"min\", \"1\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"parentesco\"], [\"id\", \"parentesco\", \"name\", \"parentesco\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"value\", \"\"], [\"value\", \"Padre\"], [\"value\", \"Madre\"], [\"value\", \"Hijo/a\"], [\"value\", \"Hermano/a\"], [\"value\", \"Otro\"], [1, \"col-md-2\", \"d-flex\", \"align-items-end\"], [\"type\", \"submit\", 1, \"btn\", \"btn-success\", \"btn-block\", 3, \"disabled\"], [1, \"fas\", \"fa-save\"], [1, \"card\"], [1, \"table\", \"table-bordered\"], [1, \"text-center\"], [4, \"ngFor\", \"ngForOf\"]],\n      template: function ComprasComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h4\");\n          i0.ɵɵtext(4, \"Agregar Nueva Persona\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(5, \"div\", 3)(6, \"form\", 4, 5);\n          i0.ɵɵlistener(\"ngSubmit\", function ComprasComponent_Template_form_ngSubmit_6_listener() {\n            return ctx.guardar();\n          });\n          i0.ɵɵelementStart(8, \"div\", 6)(9, \"div\", 7)(10, \"div\", 8)(11, \"label\", 9);\n          i0.ɵɵtext(12, \"Nombre\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(13, \"input\", 10);\n          i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_Template_input_ngModelChange_13_listener($event) {\n            return ctx.nuevaPersona.nombre = $event;\n          });\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(14, \"div\", 11)(15, \"div\", 8)(16, \"label\", 12);\n          i0.ɵɵtext(17, \"Edad\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(18, \"input\", 13);\n          i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_Template_input_ngModelChange_18_listener($event) {\n            return ctx.nuevaPersona.edad = $event;\n          });\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(19, \"div\", 11)(20, \"div\", 8)(21, \"label\", 14);\n          i0.ɵɵtext(22, \"Parentesco\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(23, \"select\", 15);\n          i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_Template_select_ngModelChange_23_listener($event) {\n            return ctx.nuevaPersona.parentesco = $event;\n          });\n          i0.ɵɵelementStart(24, \"option\", 16);\n          i0.ɵɵtext(25, \"Seleccione...\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(26, \"option\", 17);\n          i0.ɵɵtext(27, \"Padre\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(28, \"option\", 18);\n          i0.ɵɵtext(29, \"Madre\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(30, \"option\", 19);\n          i0.ɵɵtext(31, \"Hijo/a\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(32, \"option\", 20);\n          i0.ɵɵtext(33, \"Hermano/a\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(34, \"option\", 21);\n          i0.ɵɵtext(35, \"Otro\");\n          i0.ɵɵelementEnd()()()();\n          i0.ɵɵelementStart(36, \"div\", 22)(37, \"button\", 23);\n          i0.ɵɵelement(38, \"i\", 24);\n          i0.ɵɵtext(39, \" Guardar \");\n          i0.ɵɵelementEnd()()()()()();\n          i0.ɵɵelementStart(40, \"div\", 25)(41, \"h3\");\n          i0.ɵɵtext(42);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(43, \"table\", 26)(44, \"thead\")(45, \"tr\")(46, \"th\");\n          i0.ɵɵtext(47, \"Codigo\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(48, \"th\");\n          i0.ɵɵtext(49, \"Nombre\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(50, \"th\");\n          i0.ɵɵtext(51, \"Edad\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(52, \"th\");\n          i0.ɵɵtext(53, \"Parentesco\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(54, \"th\", 27);\n          i0.ɵɵtext(55, \"ACCIONES\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(56, \"tbody\");\n          i0.ɵɵtemplate(57, ComprasComponent_tr_57_Template, 10, 4, \"tr\", 28);\n          i0.ɵɵelementEnd()()()();\n        }\n        if (rf & 2) {\n          const _r0 = i0.ɵɵreference(7);\n          i0.ɵɵadvance(13);\n          i0.ɵɵproperty(\"ngModel\", ctx.nuevaPersona.nombre);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngModel\", ctx.nuevaPersona.edad);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngModel\", ctx.nuevaPersona.parentesco);\n          i0.ɵɵadvance(14);\n          i0.ɵɵproperty(\"disabled\", !_r0.valid);\n          i0.ɵɵadvance(5);\n          i0.ɵɵtextInterpolate1(\"Totales (\", ctx.obj.length, \") \");\n          i0.ɵɵadvance(15);\n          i0.ɵɵproperty(\"ngForOf\", ctx.obj);\n        }\n      },\n      dependencies: [i4.NgForOf, i5.ɵNgNoValidate, i5.NgSelectOption, i5.ɵNgSelectMultipleOption, i5.DefaultValueAccessor, i5.NumberValueAccessor, i5.SelectControlValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.RequiredValidator, i5.MinValidator, i5.NgModel, i5.NgForm]\n    });\n  }\n  return ComprasComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}