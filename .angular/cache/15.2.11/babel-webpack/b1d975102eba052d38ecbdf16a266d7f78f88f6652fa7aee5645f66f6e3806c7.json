{"ast":null,"code":"import { Compra } from 'src/app/Modelo/Compra';\nimport { ProdcutosCompra } from 'src/app/Modelo/ProductosCompra';\nimport { MyTable } from 'src/app/Modelo/mytable';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"src/app/Service/compras.service\";\nimport * as i2 from \"src/app/Service/productos.service\";\nimport * as i3 from \"src/app/Service/serviciotable.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/forms\";\nfunction ComprasComponent_tr_56_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"tr\")(1, \"td\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"td\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"td\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"td\");\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"td\", 28);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const b_r2 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(b_r2.id);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(b_r2.nombre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(b_r2.edad);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(b_r2.parentesco);\n  }\n}\nexport let ComprasComponent = /*#__PURE__*/(() => {\n  class ComprasComponent {\n    constructor(servicioCompras, servicioProductos, serviceTable) {\n      this.servicioCompras = servicioCompras;\n      this.servicioProductos = servicioProductos;\n      this.serviceTable = serviceTable;\n      this.nuevaPersona = new MyTable(null, '', null, '');\n      this.mostrarNuevaCompra = false;\n      this.totalNuevaCompra = 0;\n      this.mostrarDetalles = false;\n    }\n    ngOnInit() {\n      this.serviceTable.getTable().subscribe(data => {\n        this.obj = data;\n        //this.traerProductos();\n      }, error => {\n        console.log(error);\n      });\n    }\n    guardar() {\n      // Aquí va tu lógica para guardar (ejemplo con HTTP POST)\n      this.serviceTable.postTable(this.nuevaPersona).subscribe({\n        next: data => {\n          this.nuevaPersona.id = Number(data.id);\n          alert('Persona guardada correctamente');\n          this.obj.unshift(this.nuevaPersona); // Agrega la nueva persona a la tabla\n          this.resetForm();\n        },\n        error: err => {\n          console.error('Error al guardar:', err);\n          alert('Error al guardar la persona');\n        }\n      });\n    }\n    resetForm() {\n      this.nuevaPersona = {\n        id: null,\n        nombre: '',\n        edad: null,\n        parentesco: ''\n      };\n    }\n    verDetalles(compra) {\n      this.mostrarDetalles = true;\n      this.servicioProductos.getProductosNuevaCompra(compra.codigo, this.getRolDB()).subscribe(data => {\n        this.productosNuevaCompra = data;\n        this.codigoDetalleCompra = compra.codigo;\n        this.totalNuevaCompra = compra.total_compra;\n      });\n    }\n    filtrarCompras(filtro) {\n      console.log(\"filtro: \" + filtro);\n    }\n    getRolDB() {\n      let stringUser = localStorage.getItem('usuario');\n      let usuario = stringUser ? JSON.parse(stringUser) : null;\n      let rol = usuario ? usuario.rol : 0;\n      return rol;\n    }\n    getIDUser() {\n      let stringUser = localStorage.getItem('usuario');\n      let usuario = stringUser ? JSON.parse(stringUser) : null;\n      let rol = usuario ? usuario.identificacion : 0;\n      return rol;\n    }\n    getSucursal() {\n      let stringUser = localStorage.getItem('usuario');\n      let usuario = stringUser ? JSON.parse(stringUser) : null;\n      let suc = usuario ? usuario.sucursal : 0;\n      return suc;\n    }\n    nuevaCompra() {\n      //hacer que se agregue una nueva compra\n      this.productosNuevaCompra = [];\n      this.totalNuevaCompra = 0;\n      this.mostrarNuevaCompra = true;\n      let compra = new Compra();\n      compra.usuario = this.getIDUser();\n      compra.sucursal = this.getSucursal();\n      this.servicioCompras.nuevaCompra(compra, this.getRolDB()).subscribe(data => {\n        this.codigoNuevaCompra = data.codigo_compra;\n        console.log(this.codigoNuevaCompra);\n      }, error => {\n        console.log(error);\n      });\n    }\n    traerProductosNuevaCompra(idC) {\n      this.servicioProductos.getProductosNuevaCompra(idC, this.getRolDB()).subscribe(data => {\n        this.productosNuevaCompra = data;\n      }, error => {\n        console.log(error);\n      });\n    }\n    agregarProductoACompra(nuevaCompraForm) {\n      let pc = new ProdcutosCompra(this.codigoNuevaCompra, parseInt(this.productoSeleccionado), this.cantidadProducto, this.precioProducto);\n      this.servicioProductos.nuevoProductoCompra(pc, this.getRolDB()).subscribe(data => {\n        console.log(data);\n        this.traerProductosNuevaCompra(this.codigoNuevaCompra);\n        nuevaCompraForm.resetForm();\n        this.totalNuevaCompra += pc.cantidad * pc.precio_unitario;\n        this.traerProductos();\n      }, error => {\n        console.log(error);\n        alert(\"No cuentas con el dinero sufuciente para realizar esta compra, por favor comunicate con el administrador\");\n      });\n    }\n    traerProductos() {\n      this.servicioProductos.getProductosSucursal(this.getSucursal(), this.getRolDB()).subscribe(data => {\n        this.productos = data;\n      }, error => {\n        console.log(error);\n      });\n    }\n    dejarDeMostrarNuevaCompra() {\n      this.mostrarNuevaCompra = false;\n      if (this.totalNuevaCompra == 0) {\n        //eliminar la compra\n        this.servicioCompras.deleteCompra(this.getRolDB(), this.codigoNuevaCompra).subscribe(data => {\n          console.log(\"compra eliminada\");\n          this.ngOnInit();\n        });\n      } else {\n        this.ngOnInit();\n      }\n    }\n    cancelarCompra() {\n      this.servicioCompras.cancelarCompra(this.getRolDB(), this.codigoNuevaCompra).subscribe(data => {\n        alert(\"Se la cancelado al compra!\");\n        this.mostrarNuevaCompra = false;\n        this.ngOnInit();\n      }, error => {\n        console.log(error);\n      });\n    }\n    static #_ = this.ɵfac = function ComprasComponent_Factory(t) {\n      return new (t || ComprasComponent)(i0.ɵɵdirectiveInject(i1.ComprasService), i0.ɵɵdirectiveInject(i2.ProductosService), i0.ɵɵdirectiveInject(i3.ServiciotableService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: ComprasComponent,\n      selectors: [[\"app-compras\"]],\n      decls: 57,\n      vars: 6,\n      consts: [[1, \"container\", \"mt-5\", \"pt-5\"], [1, \"card\", \"mb-4\"], [1, \"card-header\", \"bg-primary\", \"text-white\"], [1, \"card-body\"], [3, \"ngSubmit\"], [\"personaForm\", \"ngForm\"], [1, \"row\"], [1, \"col-12\", \"col-sm-6\", \"col-md-4\", \"mb-3\"], [\"for\", \"nombre\"], [\"type\", \"text\", \"id\", \"nombre\", \"name\", \"nombre\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [1, \"col-12\", \"col-sm-6\", \"col-md-3\", \"mb-3\"], [\"for\", \"edad\"], [\"type\", \"number\", \"id\", \"edad\", \"name\", \"edad\", \"required\", \"\", \"min\", \"1\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"for\", \"parentesco\"], [\"id\", \"parentesco\", \"name\", \"parentesco\", \"required\", \"\", 1, \"form-control\", 3, \"ngModel\", \"ngModelChange\"], [\"value\", \"\"], [\"value\", \"Padre\"], [\"value\", \"Madre\"], [\"value\", \"Hijo/a\"], [\"value\", \"Hermano/a\"], [\"value\", \"Otro\"], [1, \"col-12\", \"col-sm-6\", \"col-md-2\", \"mb-3\", \"d-flex\", \"align-items-end\"], [\"type\", \"submit\", 1, \"btn\", \"btn-success\", \"btn-block\", 3, \"disabled\"], [1, \"fas\", \"fa-save\"], [1, \"card\"], [1, \"table-responsive\"], [1, \"table\", \"table-bordered\", \"mb-0\"], [1, \"thead-light\"], [1, \"text-center\"], [4, \"ngFor\", \"ngForOf\"]],\n      template: function ComprasComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"h4\");\n          i0.ɵɵtext(4, \"Agregar Nueva Persona\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(5, \"div\", 3)(6, \"form\", 4, 5);\n          i0.ɵɵlistener(\"ngSubmit\", function ComprasComponent_Template_form_ngSubmit_6_listener() {\n            return ctx.guardar();\n          });\n          i0.ɵɵelementStart(8, \"div\", 6)(9, \"div\", 7)(10, \"label\", 8);\n          i0.ɵɵtext(11, \"Nombre\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(12, \"input\", 9);\n          i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_Template_input_ngModelChange_12_listener($event) {\n            return ctx.nuevaPersona.nombre = $event;\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(13, \"div\", 10)(14, \"label\", 11);\n          i0.ɵɵtext(15, \"Edad\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(16, \"input\", 12);\n          i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_Template_input_ngModelChange_16_listener($event) {\n            return ctx.nuevaPersona.edad = $event;\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(17, \"div\", 10)(18, \"label\", 13);\n          i0.ɵɵtext(19, \"Parentesco\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(20, \"select\", 14);\n          i0.ɵɵlistener(\"ngModelChange\", function ComprasComponent_Template_select_ngModelChange_20_listener($event) {\n            return ctx.nuevaPersona.parentesco = $event;\n          });\n          i0.ɵɵelementStart(21, \"option\", 15);\n          i0.ɵɵtext(22, \"Seleccione...\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(23, \"option\", 16);\n          i0.ɵɵtext(24, \"Padre\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(25, \"option\", 17);\n          i0.ɵɵtext(26, \"Madre\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(27, \"option\", 18);\n          i0.ɵɵtext(28, \"Hijo/a\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(29, \"option\", 19);\n          i0.ɵɵtext(30, \"Hermano/a\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(31, \"option\", 20);\n          i0.ɵɵtext(32, \"Otro\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(33, \"div\", 21)(34, \"button\", 22);\n          i0.ɵɵelement(35, \"i\", 23);\n          i0.ɵɵtext(36, \" Guardar \");\n          i0.ɵɵelementEnd()()()()()();\n          i0.ɵɵelementStart(37, \"div\", 24)(38, \"div\", 3)(39, \"h5\");\n          i0.ɵɵtext(40);\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(41, \"div\", 25)(42, \"table\", 26)(43, \"thead\", 27)(44, \"tr\")(45, \"th\");\n          i0.ɵɵtext(46, \"C\\u00F3digo\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(47, \"th\");\n          i0.ɵɵtext(48, \"Nombre\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(49, \"th\");\n          i0.ɵɵtext(50, \"Edad\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(51, \"th\");\n          i0.ɵɵtext(52, \"Parentesco\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(53, \"th\", 28);\n          i0.ɵɵtext(54, \"Acciones\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(55, \"tbody\");\n          i0.ɵɵtemplate(56, ComprasComponent_tr_56_Template, 10, 4, \"tr\", 29);\n          i0.ɵɵelementEnd()()()()()();\n        }\n        if (rf & 2) {\n          const _r0 = i0.ɵɵreference(7);\n          i0.ɵɵadvance(12);\n          i0.ɵɵproperty(\"ngModel\", ctx.nuevaPersona.nombre);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.nuevaPersona.edad);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"ngModel\", ctx.nuevaPersona.parentesco);\n          i0.ɵɵadvance(14);\n          i0.ɵɵproperty(\"disabled\", !_r0.valid);\n          i0.ɵɵadvance(6);\n          i0.ɵɵtextInterpolate1(\"Totales (\", ctx.obj.length, \")\");\n          i0.ɵɵadvance(16);\n          i0.ɵɵproperty(\"ngForOf\", ctx.obj);\n        }\n      },\n      dependencies: [i4.NgForOf, i5.ɵNgNoValidate, i5.NgSelectOption, i5.ɵNgSelectMultipleOption, i5.DefaultValueAccessor, i5.NumberValueAccessor, i5.SelectControlValueAccessor, i5.NgControlStatus, i5.NgControlStatusGroup, i5.RequiredValidator, i5.MinValidator, i5.NgModel, i5.NgForm]\n    });\n  }\n  return ComprasComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}